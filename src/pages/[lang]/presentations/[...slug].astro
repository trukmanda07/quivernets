---
/**
 * Dynamic Presentation Route (reveal.js version)
 * Handles all presentations with language support
 * Routes: /{lang}/presentations/{slug}
 *
 * NEW: Loads presentations from file-based structure
 * src/content/presentations-{lang}/{slug}/
 */

import RevealLayout from '../../../layouts/RevealLayout.astro';
import RevealPresentation from '../../../components/RevealPresentation.astro';
import { getDefaultPresentationService } from '../../../services/presentation/PresentationService';
import { getDefaultPresentationRepository } from '../../../infrastructure/presentation/FileSystemPresentationRepository';
import type { Language } from '../../../domain/blog/types';

export async function getStaticPaths() {
  const paths = [];
  const languages: Language[] = ['en', 'id'];
  const repository = getDefaultPresentationRepository();
  const service = getDefaultPresentationService();

  // Generate paths for all presentations in all languages
  for (const lang of languages) {
    const slugs = await repository.getSlugs(lang);

    for (const slug of slugs) {
      // Load presentation view model from service
      const presentation = await service.getPresentationBySlug(slug, lang);

      if (presentation) {
        paths.push({
          params: { lang, slug },
          props: {
            metadata: {
              title: presentation.title,
              description: presentation.description,
              pubDate: presentation.pubDate,
              relatedBlogPost: presentation.relatedBlogPost,
              category: presentation.category,
              tags: presentation.tags,
              difficulty: presentation.difficulty,
              estimatedTime: presentation.estimatedTime,
              totalSlides: presentation.totalSlides,
              author: presentation.author,
            },
            slides: presentation.slides,
            lang,
            slug
          }
        });
      }
    }
  }

  return paths;
}

interface Props {
  metadata: any;
  slides: any[];
  lang: string;
  slug: string;
}

const { metadata, slides, lang, slug } = Astro.props;
---

<RevealLayout
  title={metadata.title}
  description={metadata.description}
  language={lang}
  theme="custom"
>
  <RevealPresentation
    title={metadata.title}
    slides={slides}
    relatedBlogPost={metadata.relatedBlogPost}
    language={lang}
    displayMode="instagram"
    slug={slug}
  />
</RevealLayout>
